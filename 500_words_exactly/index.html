<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="../_bootstrap/css/bootstrap.css" rel="stylesheet">
  <link href="main.css" rel="stylesheet">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="shortcut icon" href="_story_images/coo.ico">

  <title aria-label="This is a website that shares short stories aimed at 5-14 year olds">500 Words</title>
</head>
<body>
  <div class="orientation-warning">
    <h1>
      <a>
        <img src="_story_images/500_title.png" alt="Cover image for the story 500_title" class="img-fluid-title">
      </a>
    </h1>
    Please rotate your device to portrait mode for the best experience.
  </div>
  <div class="fixed-top">
    <div class="header container text-center my-3">
      <h1>
        <a>
          <img src="_story_images/500_title.png" alt="Cover image for the story 500_title" class="img-fluid-title">
        </a>
      </h1>
    </div>
  
    <div class="container text-center mb-1">
      <div class="button-container">
        <a href="_info/500_words.html" class="btn btn-secondary mx-1 hover-effect-btn" data-bs-toggle="tooltip" title="Learn more about 500 words">About 500 Words</a>
        <a href="_info/foreward.html" class="btn btn-danger mx-1 hover-effect-btn" data-bs-toggle="tooltip" title="A bit of an intro.">Foreward</a>
        <a href="_info/acknowledgements.html" class="btn btn-warning mx-1 hover-effect-btn" data-bs-toggle="tooltip" title="These people deserve some thanks.">Acknowledgements</a>
        <a href="_info/cast1000.html" class="btn btn-primary mx-1 hover-effect-btn">Cast of a Thousand</a>
        <a href="_info/random_story.html" class="btn btn-success mx-1 hover-effect-btn" data-bs-toggle="tooltip" title="Complete pot luck.">Random Story</a>
        <form action="https://www.paypal.com/donate" method="post" target="_blank" class="d-inline mx-1 hover-effect-btn">
          <input type="hidden" name="hosted_button_id" value="LFV8A8Q4EVHU6">
          <button type="submit" class="btn btn-info hover-effect-btn" aria-label="A button to buy me a coffee, opens new paypal tab" data-bs-toggle="tooltip" title="I really want to keep these pages ad free, a coffee will help.">Donate a Coffee</button>
        </form>
        <a href="_info/future_stuff.html" class="btn btn-primary mx-1 hover-effect-btn" data-bs-toggle="tooltip" title="Things i'm working on">Future Stories</a>
        <a href="your_index.html" class="btn btn-warning mx-1 hover-effect-btn" data-bs-toggle="tooltip" title="Things you worked on">All Your Stories</a>
      </div>
    </div>
  </div>
  
  <!-- Responsive Grid for Stories -->
  <div class="main-content" style="margin-top: var(--fixed-top-height)">
    <div class="scrollable-container">
      <div class="container">
        <div class="row" id="stories-container">
              <!-- Stories appear here-->
        </div>
      </div>
    </div>
  </div>
  <br>
  <div class="footer d-flex align-items-center justify-content-evenly">
      <a href="https://www.bbc.co.uk/teach/500-words" aria-label="A button to the official BBC 500 words page">500 words - BBC</a>
      <a href="https://www.storycubes.com/en/" aria-label="A button to take you to Rory's story cubes page">Rory's story cubes</a>
      <a href="_info/sitemap.html" aria-label="A button to take you to an image of the sitemap">Site Map</a>
  </div>
  <br>

<script>
// file: what the website needs - no punctuation - Proper formatting.
// title: what the user sees.
// description: used by screen reader to explain the image on the webpage.
window.stories = [
  { file: "Fog", title: "Fog", description: "about a collector" },
  { file: "Snot", title: "Snot", description: "about a dirty boy" },
  { file: "Windbag", title: "Windbag", description: "about a cow" },
  { file: "The Wrong Spatula", title: "The Wrong Spatula", description: "about a cook" },
  { file: "Frankie Skid - Fearless Squid", title: "Frankie Skid - Fearless Squid", description: "about a daredevil octopus" },
  { file: "Noodle Pig", title: "Noodle Pig", description: "about a dog" },
  { file: "Couch Potato", title: "Couch Potato", description: "about lazy Alan" },
  { file: "Gary Blizzard - Almost Wizard", title: "Gary Blizzard - Almost Wizard", description: "about a boy who finds a stick" },
  { file: "Cone Of Shame", title: "Cone of Shame", description: "about a dog that licks things" },
  { file: "Whats That Noise", title: "What's That Noise?", description: "about a strange noise" },
  { file: "Doctor Boomers Alternative Medicine", title: "Doctor Boomer's Alternative Medicine", description: "about a disgusting medication" },
  { file: "Visitors", title: "Visitors", description: "about aliens" },
  { file: "Space Armada", title: "Space Armada", description: "and an encounter with more aliens" },
  { file: "Where Exactly Did You Put The Moon Kevin", title: "Where, Exactly did you put the Moon Kevin?", description: "about a geeky boy" },
  { file: "Detention", title: "Detention", description: "about a science teacher" },
  { file: "Nuts", title: "Nuts", description: "about a squirrel" },
  { file: "Blue Whale Cheese", title: "Blue Whale Cheese", description: "about alternative food" },
  { file: "Mikes Magic Underpants", title: "Mike's Magic Underpants", description: "about an old carpet" },
  { file: "Slug", title: "Slug", description: "about slugs" },
  { file: "Day 1347", title: "Day 1347", description: "about an experiment" },
  { file: "The Dripping Tap", title: "The Dripping Tap", description: "about a boy that fixes things"  },
  { file: "The School Of Mum And Dad", title: "The School of Mum and Dad", description: "about homeschooling" },
  { file: "Halfway Up A Mountain", title: "Halfway up a Mountain", description: "about a nice family walk" },
  { file: "Dihydrogen Monoxide", title: "Di-Hydrogen Monoxide", description: "about weather" },
  { file: "Odd Socks", title: "Odd Socks", description: "about a washing machine" },
  { file: "I Dont Like THAT Colour", title: "I don't like THAT colour", description: "it has sheep in it" },
  { file: "Bless You", title: "Bless You", description: "about a Ladybird and Venus flytrap" },
  
  // Serial Episode Stories - can commented out to remove from index.HTML, add them to seed.js to populate fireBase.
  { file: "Its Exactly Where I Left It", title: "It's exactly where I left it", description: "part 2 about Kevin" },
  { file: "Can You Make It Big Again", title: "Can you make it big again?", description: "part 3 about Kevin" },
  { file: "Thats A Relief", title: "That's a relief", description: "parts 4 about Kevin" },
];
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
  import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBUFP5TU2htdupxb4wVPpQodIUSxC_cDbY",
    authDomain: "words-b33f3.firebaseapp.com",
    projectId: "words-b33f3",
    storageBucket: "words-b33f3.firebasestorage.app",
    messagingSenderId: "538544822188",
    appId: "1:538544822188:web:1d776fde1ae5b312824c09",
    measurementId: "G-8629EV9H61"
  };

  // Initialise Firebase and Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Expose db to the global variables
  window.db = db;

  // Wait until the DOM is fully loaded
  document.addEventListener('DOMContentLoaded', async () => {
    // Loop through each story in the global stories array
    for (const story of window.stories) {
      // Create a reference to the Firestore document (using the story.file as the id)
      const storyRef = doc(db, 'stories', story.file);
      try {
        const docSnap = await getDoc(storyRef);
        // Default likeCount is 0 if no document exists or field is missing
        let likeCount = 0;
        if (docSnap.exists()) {
          likeCount = (docSnap.data().like_count + docSnap.data().unlike_count) || 0;
        }
        // Get the corresponding placeholder element
        const likeDisplay = document.getElementById(`like-display-${story.file}`);
        if (likeDisplay) {
          if (likeCount > 0) {
            likeDisplay.innerHTML = `<i class="bi bi-emoji-smile-fill" style="color: green;"></i> ${likeCount}`;
          } else if (likeCount < 0) {
            likeDisplay.innerHTML = `<i class="bi bi-emoji-frown-fill" style="color: firebrick;"></i> ${likeCount}`;
          } else {
            // If zero, show nothing 
            likeDisplay.innerHTML = '';
          }
        }
      } catch (error) {
        console.error(`Error fetching like count for ${story.file}: `, error);
      }
    }
  });
</script>

</script>

<script>

// this makes each story instance on the index page - image, title and like count.
function renderStories(stories) {
  const container = document.getElementById('stories-container');
  container.innerHTML = stories.map(story => `
    <div class="col-12 col-sm-6 col-md-4 col-lg-3 box hover-effect">
      <a href="story.html?story=${encodeURIComponent(story.file)}">
        <img src="_story_images/${story.file}.png" alt="Cover image for the story ${story.title}" class="img-fluid hover-effect">
        <h4 class="visually-hidden">A story called ${story.title}, ${story.description}, Written by Phil Lancelotte</h4>
      </a>
      <div style="display: flex; align-items: center;">
        <h4 aria-hidden="true" style="margin: 0;">${story.title}</h4>
        <h3 style="margin: 5px;">
          <span id="like-display-${story.file}" style="white-space: nowrap;"></span>
        </h3>
      </div>
    </div>
  `).join('');
}

document.addEventListener('DOMContentLoaded', () => renderStories(stories));

// on page load, determine height of fixed-top element 
window.addEventListener('load', () => {

  const fixedTop = document.querySelector('.fixed-top');
  const height = fixedTop.offsetHeight;
  console.log("Fixed-top height:", height);
  
  // set a CSS variable for use in index and story stylesheet:
  document.documentElement.style.setProperty('--fixed-top-height', `${height}px`);
});


</script>

</body>
</html>
